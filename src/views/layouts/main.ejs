<!DOCTYPE html>
<html lang="<%= user?.language || 'en' %>" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title><%= title || 'BookNotes' %> - BookNotes</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script>
        (function() {
            var s = localStorage.getItem('booknotes-theme');
            if (s === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
            }
        })();
    </script>
    <style>
        .mobile-toggle{display:none;width:36px;height:36px;border-radius:10px;border:1px solid var(--border);background:var(--surface-2);color:var(--text-sub);cursor:pointer;font-size:.95rem;align-items:center;justify-content:center;transition:all .25s}
        .mobile-toggle:hover{border-color:var(--primary);color:var(--primary)}
        .mobile-menu{display:none;position:fixed;top:64px;left:0;right:0;bottom:0;background:var(--surface);z-index:99;padding:20px;flex-direction:column;gap:8px;border-top:1px solid var(--border);animation:mobileSlide .25s ease;overflow-y:auto}
        .mobile-menu.open{display:flex}
        .mobile-menu a{display:flex;align-items:center;gap:12px;padding:14px 16px;border-radius:var(--radius-sm);font-size:.92rem;font-weight:600;color:var(--text-sub);transition:all .2s;border:1px solid transparent}
        .mobile-menu a:hover,.mobile-menu a.active{background:var(--glow);color:var(--primary);border-color:var(--border)}
        .mobile-menu a i{width:20px;text-align:center}
        .mobile-menu-divider{height:1px;background:var(--border);margin:8px 0}
        .mobile-menu-user{display:flex;align-items:center;gap:12px;padding:16px;background:var(--surface-2);border-radius:var(--radius-sm);margin-bottom:8px;border:1px solid var(--border)}
        .mobile-menu-user span{font-weight:700;font-size:.9rem}
        .mobile-menu-user small{color:var(--text-muted);font-size:.78rem}
        @keyframes mobileSlide{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}
        @media(max-width:768px){
            .mobile-toggle{display:flex}
            .navbar-menu{display:none!important}
        }
        .body-no-scroll{overflow:hidden}
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-content">
                <a href="/" class="navbar-brand">
                    <div class="navbar-brand-icon"><i class="fas fa-book-open"></i></div>
                    <span class="navbar-brand-text">BookNotes</span>
                </a>

                <ul class="navbar-menu">
                    <li>
                        <a href="/dashboard" class="<%= page === 'dashboard' ? 'active' : '' %>">
                            <i class="fas fa-th-large"></i> <%= __('nav.dashboard') %>
                        </a>
                    </li>
                    <li>
                        <a href="/books" class="<%= page === 'books' ? 'active' : '' %>">
                            <i class="fas fa-book"></i> <%= __('nav.myBooks') %>
                        </a>
                    </li>
                    <li>
                        <a href="/books/add" class="<%= page === 'add-book' ? 'active' : '' %>">
                            <i class="fas fa-plus-circle"></i> <%= __('nav.addBook') %>
                        </a>
                    </li>
                </ul>

                <div class="navbar-user">
                    <div class="language-switcher">
                        <a href="/language/en?returnTo=<%= currentPath || '/' %>" class="<%= user?.language === 'en' ? 'active' : '' %>">EN</a>
                        <a href="/language/tr?returnTo=<%= currentPath || '/' %>" class="<%= user?.language === 'tr' ? 'active' : '' %>">TR</a>
                    </div>

                    <button type="button" class="theme-toggle-btn" id="themeToggle" aria-label="Toggle theme">
                        <i class="fas fa-moon" id="themeIcon"></i>
                    </button>

                    <div class="user-avatar">
                        <%= user?.username?.charAt(0).toUpperCase() || 'U' %>
                    </div>

                    <a href="/auth/logout" class="btn btn-sm btn-secondary" aria-label="<%= __('nav.logout') %>" title="<%= __('nav.logout') %>">
                        <i class="fas fa-sign-out-alt"></i>
                    </a>

                    <button type="button" class="mobile-toggle" id="mobileToggle" aria-label="<%= __('nav.menu') %>">
                        <i class="fas fa-bars" id="mobileToggleIcon"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-user">
            <div class="user-avatar"><%= user?.username?.charAt(0).toUpperCase() || 'U' %></div>
            <div>
                <span><%= user?.username || 'User' %></span><br>
                <small><%= user?.email || '' %></small>
            </div>
        </div>
        <a href="/dashboard" class="<%= page === 'dashboard' ? 'active' : '' %>">
            <i class="fas fa-th-large"></i> <%= __('nav.dashboard') %>
        </a>
        <a href="/books" class="<%= page === 'books' ? 'active' : '' %>">
            <i class="fas fa-book"></i> <%= __('nav.myBooks') %>
        </a>
        <a href="/books/add" class="<%= page === 'add-book' ? 'active' : '' %>">
            <i class="fas fa-plus-circle"></i> <%= __('nav.addBook') %>
        </a>
        <div class="mobile-menu-divider"></div>
        <a href="/auth/logout">
            <i class="fas fa-sign-out-alt"></i> <%= __('nav.logout') %>
        </a>
    </div>

    <% if (success && success.length > 0) { %>
        <div class="container" style="margin-top: 24px;">
            <div class="alert alert-success">
                <i class="fas fa-check-circle"></i>
                <%= success %>
            </div>
        </div>
    <% } %>

    <% if (error && error.length > 0) { %>
        <div class="container" style="margin-top: 24px;">
            <div class="alert alert-error">
                <i class="fas fa-exclamation-circle"></i>
                <%= error %>
            </div>
        </div>
    <% } %>

    <main style="padding: 32px 0; min-height: calc(100vh - 160px);">
        <%- body %>
    </main>

    <footer style="padding: 20px 0; border-top: 1px solid var(--border); transition: border var(--transition-slow);">
        <div class="container" style="text-align: center;">
            <p style="color: var(--text-muted); font-size: 0.82rem; font-weight: 500;">
                &copy; 2026 BookNotes &middot; <%= __('footer.madeWith') %> <i class="fas fa-heart" style="color: #f43f5e;"></i> <%= __('footer.by') %>
            </p>
        </div>
    </footer>

    <script src="/js/main.js"></script>
</body>
</html>
